import{r,O as i,I as h}from"./op-fac60542.js";class p{constructor(t,s){this.value=t??null,this.clientId=s??r(6),this.clock=0,this.ops=[]}get(){return this.value}set(t){this.value=t,this.ops.push({type:i.Set,value:t,id:[this.clientId,++this.clock]})}apply(t){const s=t.id;if(!(this.clock>s[1])&&!(this.clock===s[1]&&this.clientId>s[0]))if(t.type===i.Set)this.value=t.value,this.clock=s[1];else throw new Error(`Unsupport op type: ${t.type}`)}ack(t){this.ops=this.ops.filter(s=>!h.equals(s.id,t.id))}flush(){return this.ops}}class n{constructor(t){this.map=new Map,this.clientId=t??r(6),this.clock=0,this.ops=[]}get(t){return this.map.get(t)??null}set(t,s){this.map.set(t,s),this.ops.push({type:i.KV,value:JSON.stringify([t,s]),id:[this.clientId,++this.clock]})}apply(t){const s=t.id;if(!(this.clock>s[1])&&!(this.clock===s[1]&&this.clientId>s[0]))if(t.type===i.KV){const[e,l]=JSON.parse(t.value);this.map.set(e,l),this.clock=s[1]}else throw new Error(`Unsupport op type: ${t.type}`)}ack(t){this.ops=this.ops.filter(s=>!h.equals(s.id,t.id))}flush(){return this.ops}toJSON(){const t={};for(const[s,e]of this.map)t[s]=e;return t}}export{n as M,p as O};
